---
title: "[Node.js] ë¹„ë™ê¸°(Asynchronous)ì™€ ì´ë²¤íŠ¸ ë£¨í”„(Event Loop)"
excerpt: "Node.jsì˜ í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜ì¸ ë¹„ë™ê¸°ì™€ ì´ë²¤íŠ¸ ë£¨í”„ì˜ êµ¬í˜„ì„ ëœ¯ì–´ë³´ì"

categories:
    - JavaScript
tags:
    - [NodeJS, Asynchronous, EventLoop]

date: 2024-10-27
last_modified_at: 2024-10-27

toc: true
toc_sticky: true
related: true
---

<div class="notice--info" markdown="1">
ğŸ‘¨â€ğŸ’» ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ ì…ë‹ˆë‹¤. <br/>
ğŸ’¡ í‹€ë¦° ë‚´ìš©ì´ë‚˜ ì˜¤íƒ€ëŠ” ëŒ“ê¸€, ë©”ì¼ë¡œ ì œë³´í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤!!  (__)
</div>

## Introduction

ì´ ê¸€ì€ Node.jsì˜ í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜ì¸ ë¹„ë™ê¸°ì™€ ì´ë²¤íŠ¸ ë£¨í”„, ê·¸ `Under the hood`ê°€ ê¶ê¸ˆí•œ ì‚¬ëŒë“¤ì„ ë…ìë¡œ ê°€ì •í•˜ê³  ì‘ì„±í•˜ì˜€ë‹¤. ë¹„ë™ê¸° ì½”ë“œë¥¼ ì‘ì„±í•´ë³¸ ê²½í—˜ì´ ìˆê³ , ìë£Œêµ¬ì¡°ì— ëŒ€í•œ ì´í•´ê°€ ìˆë‹¤ë©´ ì¢€ ë” ì‰½ê²Œ ì½ì„ ìˆ˜ ìˆì„ ê²ƒì´ë¼ê³  ìƒê°í•œë‹¤.

ìµœê·¼ í”„ë¡œì íŠ¸ë¥¼ í•˜ë‹¤ê°€ Node.jsì˜ ë‚´ì¥ ëª¨ë“ˆì¸ `fs` ë¥¼ ì‚¬ìš©í•  ì¼ì´ ìˆì—ˆê³ , ê°„í¸í•˜ê³  ë¹ ë¥´ê²Œ ì‘ì„±í•˜ë ¤ë‹¤ë³´ë‹ˆ ë™ê¸°(Synchronous) APIë¥¼ í™œìš©í–ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ ë¶€ë¶„ì´ Node.jsì˜ ê°•ì ì„ ì‚´ë¦¬ì§€ ëª»í•˜ëŠ” ë¶€ë¶„ì´ë¼ê³  í”¼ë“œë°±ì„ ë°›ì•˜ê³ , ë¹„ë™ê¸°(Asynchronous) APIë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ì–´ë–»ê² ëƒëŠ” ì œì•ˆì„ ë°›ì•˜ë‹¤. í”¼ë“œë°±ì„ ë°›ì•„ë“¤ì´ê¸´ í–ˆì§€ë§Œ, ë‚´ê°€ ì‘ì„±í•œ ì½”ë“œë¡œëŠ” ì—¬ì „íˆ ë¹„ë™ê¸°ì˜ ì¥ì ì„ í™•ì¸í•  ìˆ˜ëŠ” ì—†ì—ˆë‹¤. ê·¸ë˜ì„œ ê°„ë‹¨í•œ ì„œë²„ ì½”ë“œë¥¼ ì‘ì„±í•œ í›„, `sleep` ì—­í• ì„ í•  ìˆ˜ ìˆëŠ” ê°„ë‹¨í•œ í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ì‹¤í—˜ì„ í†µí•´ ë¹„ë™ê¸°ì˜ ê°•ì ì„ ëˆˆìœ¼ë¡œ í™•ì¸í•˜ê³ ì í–ˆë‹¤. ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì‹œì ì— `sleep` í•´ë²„ë¦¬ë©´, ë‹¤ìŒ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ì„ ê²ƒ ê°™ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤. ê·¸ ë•Œ ì‘ì„±í•œ í•¨ìˆ˜ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```ts
// ms ì´í›„ resolveë˜ëŠ” Promiseë¥¼ ë°˜í™˜
function sleep(ms: number) { 
    return new Promise((resolve) => setTimeout(resolve, ms)); 
} 


/* Request Handler ì²˜ë¦¬ */
await sleep(10000); // ê·¸ ë‹¤ìŒ 10ì´ˆ sleep
// ê·¸ëŸ¬ë©´ ë‹¤ìŒ ìš”ì²­ì€ 10ì´ˆ í›„ì— ì²˜ë¦¬í•  ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ?
```

ìë°”ìŠ¤í¬ë¦½íŠ¸ì— ëŒ€í•´ ì˜ ì•„ëŠ” ì‚¬ëŒì€ ì´ ì½”ë“œê°€ ì‹¤í—˜ì„ ì§„í–‰í•˜ê¸°ì— ë¶€ì í•©í•˜ë‹¤ëŠ” ì‚¬ì‹¤ì„ ì‰½ê²Œ ì•Œ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. ìœ„ `sleep` êµ¬í˜„ì€ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ 10ì´ˆ í›„ì— ì²˜ë¦¬í•˜ì—¬ ì •ë§ `sleep` í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ì‹¤ì œë¡œëŠ” í•´ë‹¹ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µë§Œ 10ì´ˆ í›„ì— ì²˜ë¦¬í•  ë¿ ë‹¤ë¥¸ ìš”ì²­ì„ ë°›ì•„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ìƒíƒœì´ë‹¤. ì´ê²ƒì´ Node.jsê°€ ì œê³µí•˜ëŠ” ê°•ë ¥í•¨ ì¤‘ í•˜ë‚˜ì¸ ë¹„ë™ê¸°ì´ë‹¤. **ì´ë²¤íŠ¸ ë£¨í”„(Event Loop)** ë¼ëŠ” ë©”ì»¤ë‹ˆì¦˜ì„ í†µí•´ ê°ì¢… ë¹„ë™ê¸° ì‘ì—…ì„ ì²˜ë¦¬í•œë‹¤. ì´ ë•Œë¬¸ì— ì‹¤ì œë¡œ ì½”ë“œ íë¦„ì„ ê´€ì œí•˜ëŠ” ë©”ì¸ ìŠ¤ë ˆë“œ(Thread)ëŠ” 1ê°œì´ì§€ë§Œ, ì—¬ëŸ¬ ì‘ì—…ì„ ë™ì‹œì— ì²˜ë¦¬í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì¸ë‹¤. ì•ˆì—ì„œ ë„ëŒ€ì²´ ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ê¸°ì— í•˜ë‚˜ì˜ ë©”ì¸ ìŠ¤ë ˆë“œë¡œë„ ë™ì‹œì„±ì„ ì œê³µí•  ìˆ˜ ìˆëŠ”ê±¸ê¹Œ? ì´ ê¸€ì—ì„œëŠ” ì´ë²¤íŠ¸ ë£¨í”„ì— ëŒ€í•´ ìì„¸íˆ íŒŒê³ ë“¤ì–´ ë‚´ë¶€ ë™ì‘ ì›ë¦¬ë¥¼ íŒŒí—¤ì³ë³´ë©°, ë‹¤ì–‘í•œ ì˜¤í•´ë¥¼ íƒ€íŒŒí•˜ê³ ì í•œë‹¤.

ì°¸ê³ ë¡œ, ìœ„ `sleep`ì„ ì‹¤í—˜ì˜ ì˜ë„ëŒ€ë¡œ ì‘ë™ë˜ê²Œ í•˜ë ¤ë©´ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```ts
function sleepSync(ms) { 
    const end = Date.now() + ms; 
    while (Date.now() < end) { 
        // Busy-wait ì€ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ë§‰ëŠ”ë‹¤. 
    } 
}

/* Request Handler ì²˜ë¦¬ */
sleepSync(10000); // ê·¸ ë‹¤ìŒ 10ì´ˆ sleep
// ì„œë²„ëŠ” 10ì´ˆ ë™ì•ˆ ì•„ë¬´ ì¼ë„ í•˜ì§€ ì•ŠëŠ”ë‹¤.
```

ì´ ê¸€ì„ ì½ê³ ë‚œ í›„ì—ëŠ” ë‘ `sleep` êµ¬í˜„ì— ë¬´ìŠ¨ ì°¨ì´ê°€ ìˆëŠ”ì§€, ì–´ë–¤ ì›ë¦¬ë¡œ ë™ì‘ì— ì°¨ì´ê°€ ìƒê¸°ëŠ” ê²ƒì¸ì§€ ì•Œ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

## Node.jsì˜ ê°•ì ê³¼ êµ¬ì„±ìš”ì†Œ

ë¨¼ì €, ìë°”ìŠ¤í¬ë¦½íŠ¸ ì„¤ê³„ ì² í•™ì— ëŒ€í•´ ê°„ë‹¨íˆ ì§šê³  ë„˜ì–´ê°€ì. ê¸°ë³¸ì ìœ¼ë¡œ ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰ë˜ê¸° ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ ì–¸ì–´ì´ë‹¤. ì›¹ì„œí•‘ì„ í•œë‹¤ê³  ìƒê°í•´ë³´ì. ì–´ë–¤ ì•…ì„± ì›¹ì‚¬ì´íŠ¸ê°€ ì²˜ë¦¬ê°€ ì—„ì²­ ì˜¤ë˜ê±¸ë¦¬ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚´ìœ¼ë¡œ ì¸í•´ í”„ë¦¬ì§•ì´ ê±¸ë¦¬ê³ , ê·¸ ë•Œë¬¸ì— ë‹¤ë¥¸ ì‘ì—…ì„ ì•„ë¬´ê²ƒë„ í•  ìˆ˜ ì—†ë‹¤ë©´ êµ‰ì¥íˆ ì§œì¦ë‚˜ì§€ ì•Šê² ëŠ”ê°€? ë•Œë¬¸ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ë Œë”ë§ì´ ì¼ì–´ë‚˜ëŠ” ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ë¸”ë¡œí‚¹(Blocking) ë˜ì§€ ì•Šë„ë¡ ì„¤ê³„ë˜ì—ˆë‹¤. 

ë¸Œë¼ìš°ì €ì™€ ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°„ ì˜ì¡´ì„±ì„ ë¶„ë¦¬í•˜ë ¤ëŠ” í”„ë¡œì íŠ¸ê°€ ë°”ë¡œ Node.js ì´ë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ì„¤ê³„ ì² í•™ì— ë§ê²Œ, Node.js ë˜í•œ ë©”ì¸ ìŠ¤ë ˆë“œê°€ ë¸”ë¡œí‚¹ ë˜ì§€ ì•Šë„ë¡ ì„¤ê³„ë˜ì—ˆë‹¤. í•„ìëŠ” Node.jsì˜ ê°€ì¥ í° ì¥ì ì´ ì´ ì§€ì ì´ë¼ê³  ìƒê°í•œë‹¤. í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œì˜ ì–¸ì–´ í†µí•©ìœ¼ë¡œ ì¸í•œ ìƒì‚°ì„± ì¦ëŒ€ì™€ í’ë¶€í•œ ìƒíƒœê³„ ë“± ì—¬ëŸ¬ ì¥ì ì´ ìˆê² ì§€ë§Œ, ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ í†µí•´ I/O ì‘ì—…ì„ ë¸”ë¡œí‚¹ ì—†ì´ ì²˜ë¦¬í•˜ê³  ëŒ€ê·œëª¨ ë™ì‹œ ì—°ê²°ì„ ë‹¤ë¥¸ ì„œë²„ ëª¨ë¸ì— ë¹„í•´ ë¹„êµì  íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì ì´ Node.jsì˜ ë§¤ë ¥ì¸ ê²ƒ ê°™ë‹¤. (ë©€í‹° í”„ë¡œì„¸ì‹±ì„ ì´ìš©í•˜ì—¬ ë™ì‹œ ì—°ê²°ì„ ì²˜ë¦¬í•˜ëŠ” í¬í¬ ëª¨ë¸ê³¼, ë©€í‹° ì“°ë ˆë”©ì„ ì´ìš©í•˜ì—¬ ë™ì‹œ ì—°ê²°ì„ ì²˜ë¦¬í•˜ëŠ” ìŠ¤ë ˆë“œ ëª¨ë¸ì— ë¹„í•´ ìì›ì„ ì ê²Œ ì†Œëª¨í•œë‹¤. ì„œë²„ ëª¨ë¸ì€ ì´ ê¸€ì˜ ë³¸ ê´€ì‹¬ì‚¬ê°€ ì•„ë‹ˆë¯€ë¡œ ìì„¸í•œ ì„¤ëª…ì€ ìƒëµí•œë‹¤.)

ìµœê·¼ ë¸Œë¼ìš°ì € ì ìœ ìœ¨ì„ ì°¾ì•„ë³´ì. ëŒ€ë¶€ë¶„ êµ¬ê¸€ì´ ê°œë°œí•œ í¬ë¡¬ì˜ ì˜¤í”ˆì†ŒìŠ¤ ë²„ì „ì¸ Chromium ê¸°ë°˜ì˜ ë¸Œë¼ìš°ì €ì´ë‹¤. ë¨ì„ ë§ì´ ë¨¹ëŠ”ë‹¤ëŠ” í‰ê°€ê°€ ë§ì§€ë§Œ, ì´ë ‡ê²Œ ê¹Œì§€ ì‚¬ë‘ë°›ëŠ” ì´ìœ ëŠ” ì•„ë§ˆë„ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì—”ì§„ì¸ **V8** ë•ë¶„ì´ë¼ê³  ìƒê°í•œë‹¤. (V8 ì—”ì§„ ë˜í•œ êµ¬ê¸€ì—ì„œ ê°œë°œí–ˆë‹¤.) Node.js ë˜í•œ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì—”ì§„ìœ¼ë¡œ **V8**ì„ ì‚¬ìš©í•œë‹¤. JIT(Just-In-Time) ì»´íŒŒì¼ê³¼ ê°ê° ìš©ë„ê°€ ë‹¤ë¥¸ ì—¬ëŸ¬ ì»´íŒŒì¼ëŸ¬ë¥¼ í˜¼í•©í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì„±ëŠ¥ì„ ìµœì í™”í•œë‹¤. [Firing up the Ignition interpreter Â· V8](https://v8.dev/blog/ignition-interpreter)ì„ ì°¸ê³ í•´ë³´ì.

![image](https://github.com/user-attachments/assets/ad7cb1e2-58c9-419c-904d-f4f359ed70e6)

`libuv`ë¼ê³ , Node.jsì˜ í•µì‹¬ì¸ ë¹„ë™ê¸°ì™€ ì´ë²¤íŠ¸ ë£¨í”„ êµ¬ì¡°ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ êµ¬ì„± ìš”ì†Œ ì¤‘ í•˜ë‚˜ì´ë‹¤. [ê³µì‹ë¬¸ì„œ: Design overview - libuv documentation](https://docs.libuv.org/en/stable/design.html)ë¥¼ ì°¸ê³ í•˜ë©´ Event-driven ë¹„ë™ê¸° I/Oë¥¼ í¬ë¡œìŠ¤ í”Œë«í¼ìœ¼ë¡œ ì§€ì›í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¼ê³  í•œë‹¤. ì‹¤ì œë¡œ Node.js ì´ë²¤íŠ¸ ë£¨í”„ëŠ” `libuv`ì—ì„œ ì œê³µí•˜ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ êµ¬í˜„ì„ ê¸°ë°˜ìœ¼ë¡œ, ìì²´ì ìœ¼ë¡œ ì¶”ê°€ì ì¸ ë©”ì»¤ë‹ˆì¦˜ê³¼ ì¶”ìƒí™” ê³„ì¸µì„ ì œê³µí•œë‹¤. (`libuv`ì—ì„œ ì œê³µí•˜ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ëŠ” thread-safe í•˜ì§€ ì•Šë‹¤. ì• ì´ˆì— Node.js ë‚´ë¶€ì—ì„œ ì“°ì¼ ê²ƒì„ ìƒì •í•˜ê³  ì„¤ê³„ë˜ì—ˆê³ , Node.jsì˜ ë©”ì¸ ìŠ¤ë ˆë“œëŠ” ì–´ì°¨í”¼ 1ê°œì´ê¸° ë•Œë¬¸ì— ìŠ¤ë ˆë“œ ì•ˆì •ì„±ì„ ê³ ë ¤í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸)

ìœ„ì—ì„œ ì†Œê°œëœ V8ê³¼ libuv ì™¸ì—ë„, ë‚´ì¥ ëª¨ë“ˆë“¤ê³¼ C++ë¡œ ì‘ì„±ëœ APIë¥¼ ë°”ì¸ë”©í•˜ëŠ” ê³„ì¸µ ë“± ë‹¤ì–‘í•œ ìš”ì†Œê°€ ì¡´ì¬í•˜ì§€ë§Œ, ê¸€ì˜ í•µì‹¬ ìš”ì§€ë¥¼ ë²—ì–´ë‚˜ê¸°ì— ë‚˜ë¨¸ì§€ ì„¤ëª…ì€ ìƒëµí•œë‹¤.

## ì´ë²¤íŠ¸ ë£¨í”„ì˜ íë¦„

ê³µì‹ë¬¸ì„œì—ì„  ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ì•„ë˜ì™€ ê°™ì´ 6ê°œì˜ í˜ì´ì¦ˆë¡œ ì„¤ëª…í•œë‹¤. ì‹¤ì œë¡œëŠ” ì¶”ê°€ì ì¸ ì‹¤í–‰ ë‹¨ê³„ê°€ ìˆì§€ë§Œ, ìš°ì„  ì´ 6ë‹¨ê³„ë¶€í„° ìƒì„¸íˆ ì•Œì•„ë³´ì.

> timers: `setTimeout()` and `setInterval()`ë¡œ ìŠ¤ì¼€ì¤„ëœ ì½œë°±ì„ ì‹¤í–‰
> 
> pending callbacks: ë‹¤ìŒ ë£¨í”„ ë°˜ë³µìœ¼ë¡œ ì—°ê¸°ëœ I/O ì½œë°±ì„ ì‹¤í–‰
> 
> idle, prepare: ë‚´ë¶€ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë¨
> 
> poll: ìƒˆ I/O ì´ë²¤íŠ¸ë¥¼ ì°¾ê³ , I/Oì™€ ì—°ê´€ëœ ì½œë°±ë“¤ì„ ì‹¤í–‰. ê¸°ë³¸ì ìœ¼ë¡œ ì´ ë‹¨ê³„ì—ì„œ ëŒ€ê¸°
> 
> check: `setImmediate()` ì½œë°±ë“¤ì´ ì—¬ê¸°ì„œ ì‹¤í–‰ë¨
> 
> close callbacks: `socket.on('close', ...)`ê³¼ ê°™ì´ `close` ì´ë²¤íŠ¸ì™€ ê´€ë ¨ëœ ì½œë°±ë“¤ì´ ì‹¤í–‰ë¨
> 
> [Node.js â€” The Node.js Event Loop](https://nodejs.org/en/learn/asynchronous-work/event-loop-timers-and-nexttick) - Phases Overview ë²ˆì—­

[libuvì˜ ì‹¤ì œ ì´ë²¤íŠ¸ ë£¨í”„ ì‹¤í–‰ í•¨ìˆ˜](https://github.com/nodejs/node/blob/c35cbcde4b7c8821587ad96d0e69942c01ace23d/deps/uv/src/unix/core.c#L425)ë¥¼ ë³´ë©´, ì„¤ëª…ê³¼ ë§¤ì¹­ë˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

```cpp
int uv_run(uv_loop_t* loop, uv_run_mode mode) {
  int timeout;
  int r;
  int can_sleep;

  r = uv__loop_alive(loop);
  if (!r)
      uv__update_time(loop);
  /* Maintain backwards compatibility by processing timers before entering the
   * while loop for UV_RUN_DEFAULT. Otherwise timers only need to be executed
   * once, which should be done after polling in order to maintain proper
   * execution order of the conceptual event loop. */
  if (mode == UV_RUN_DEFAULT && r != 0 && loop->stop_flag == 0) {
      uv__update_time(loop);
      uv__run_timers(loop);
  } // #1. Timers
  while (r != 0 && loop->stop_flag == 0) {
      can_sleep =
              uv__queue_empty(&loop->pending_queue) &&
              uv__queue_empty(&loop->idle_handles);
      uv__run_pending(loop); // #2. Pending
      uv__run_idle(loop); // #3. Idle
      uv__run_prepare(loop); // #3. Prepare
      timeout = 0;
      if ((mode == UV_RUN_ONCE && can_sleep) || mode == UV_RUN_DEFAULT)
          timeout = uv__backend_timeout(loop);
      uv__metrics_inc_loop_count(loop);
      uv__io_poll(loop, timeout); // #4. Poll
      /* Process immediate callbacks (e.g. write_cb) a small fixed number of
       * times to avoid loop starvation.*/
      for (r = 0; r < 8 && !uv__queue_empty(&loop->pending_queue); r++)
          uv__run_pending(loop);
      /* Run one final update on the provider_idle_time in case uv__io_poll
       * returned because the timeout expired, but no events were received. This
       * call will be ignored if the provider_entry_time was either never set (if
       * the timeout == 0) or was already updated b/c an event was received.
       */
      uv__metrics_update_idle_time(loop);
      uv__run_check(loop); // #5. Check
      uv__run_closing_handles(loop); // #6. Close callbacks
      uv__update_time(loop);
      uv__run_timers(loop); // #1. Timers...
      r = uv__loop_alive(loop);
      if (mode == UV_RUN_ONCE || mode == UV_RUN_NOWAIT)
          break;
  }
```

ê° í˜ì´ì¦ˆëŠ” ë…ë¦½ì ì¸ íë¡œ íƒœìŠ¤í¬ë¥¼ ê´€ë¦¬í•œë‹¤. ì´ë²¤íŠ¸ ë£¨í”„ê°€ í•˜ë‚˜ì˜ íë¡œ ê´€ë¦¬ëœë‹¤ëŠ” ì„œìˆ ì€ ëª…ë°±íˆ í‹€ë ¸ë‹¤. ì´ì— ëŒ€í•œ êµ¬í˜„ì€ [libuv êµ¬í˜„ì²´ í—¤ë”](https://github.com/nodejs/node/blob/c35cbcde4b7c8821587ad96d0e69942c01ace23d/deps/uv/include/uv/unix.h#L220-L251)ë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆë‹¤. ê° í˜ì´ì¦ˆì— ëŒ€í•œ êµ¬í˜„ ì½”ë“œë¥¼ ë³´ë©´ì„œ, ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚˜ëŠ”ì§€ ì•Œì•„ë³´ì.

### Timers

íƒ€ì´ë¨¸ í˜ì´ì¦ˆëŠ” `setTimeout()`ê³¼ `setInterval()`ë¡œ ë“±ë¡ëœ ì½œë°±ë“¤ì„ ì‹¤í–‰í•˜ëŠ” ë‹¨ê³„ì´ë‹¤. ì‹¤ì œ êµ¬í˜„ì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¡œ ì‘ì„±ëœ ë¶€ë¶„ë„ ìˆê³ , C++ ì½”ë“œë¥¼ ë°”ì¸ë”©í•´ì„œ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ë„ ìˆê³ , `libuv`ì˜ APIì— ì˜ì¡´í•˜ëŠ” ë¶€ë¶„ë„ ìˆë‹¤. [êµ¬í˜„ì²´ ì½”ë“œì˜ ì£¼ì„](https://github.com/nodejs/node/blob/main/lib/internal/timers.js)ì„ ë³´ë©´ ì„±ëŠ¥ì„ ìœ„í•´ ì´ë ‡ê²Œ ë³µì¡í•œ êµ¬ì¡°ë¥¼ ê°€ì§„ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

```text
// íƒ€ì´ë¨¸ êµ¬í˜„ì´ ì™œ ì´ë ‡ê²Œ ë™ì‘í•˜ëŠ”ì§€ì™€ ê·¸ ë°©ë²•.
//
// íƒ€ì´ë¨¸ëŠ” Node.jsì— ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. ë‚´ë¶€ì ìœ¼ë¡œ, ëª¨ë“  TCP I/O ì—°ê²°ì€
// ì—°ê²° ì‹œê°„ ì´ˆê³¼ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ íƒ€ì´ë¨¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ë˜í•œ, ë§ì€ ì‚¬ìš©ì
// ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ì• í”Œë¦¬ì¼€ì´ì…˜ë„ íƒ€ì´ë¨¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë”°ë¼ì„œ, ì–¸ì œë“ ì§€
// ìƒë‹¹íˆ ë§ì€ íƒ€ì„ì•„ì›ƒì´ ìŠ¤ì¼€ì¤„ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
// ê·¸ëŸ¬ë¯€ë¡œ, íƒ€ì´ë¨¸ êµ¬í˜„ì´ ì„±ëŠ¥ì´ ì¢‹ê³  íš¨ìœ¨ì ì¸ ê²ƒì´ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.
//
// ì°¸ê³ : íƒ€ì´ë¨¸ëŠ” lib/internal/linkedlist.jsì˜ ë§í¬ë“œ ë¦¬ìŠ¤íŠ¸ êµ¬í˜„ì— í¬ê²Œ
// ì˜ì¡´í•˜ë¯€ë¡œ, ë¨¼ì € í•´ë‹¹ íŒŒì¼ì„ ì½ì–´ë³´ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤. ì²˜ìŒì—ëŠ” ì•½ê°„
// ì§ê´€ì ì´ì§€ ì•Šì„ ìˆ˜ ìˆëŠ”ë°, ì‹¤ì œë¡œ í´ë˜ìŠ¤ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ëŒ€ì‹ ,
// ê¸°ì¡´ ê°ì²´ì—ì„œ ì‘ë™í•˜ëŠ” ë„ìš°ë¯¸ í•¨ìˆ˜ë“¤ì˜ ì§‘í•©ì…ë‹ˆë‹¤.
//
// ê°€ëŠ¥í•œ í•œ ì„±ëŠ¥ì„ ë†’ì´ê¸° ìœ„í•´, ì•„í‚¤í…ì²˜ì™€ ë°ì´í„° êµ¬ì¡°ëŠ” ë‹¤ìŒì˜ ì‚¬ìš© ì‚¬ë¡€ë¥¼
// ê°€ëŠ¥í•œ í•œ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤:

// - ìƒˆë¡œìš´ íƒ€ì´ë¨¸ ì¶”ê°€. (ì‚½ì…)
// - ê¸°ì¡´ íƒ€ì´ë¨¸ ì œê±°. (ì œê±°)
// - íƒ€ì´ë¨¸ì˜ ì‹œê°„ ì´ˆê³¼ ì²˜ë¦¬. (íƒ€ì„ì•„ì›ƒ)
//
// ê°€ëŠ¥í•œ í•œ ì´ëŸ¬í•œ ì—°ì‚°ë“¤ì˜ ë³µì¡ë„ë¥¼ ìƒìˆ˜ ì‹œê°„ì— ê°€ê¹ê²Œ ìœ ì§€í•˜ë ¤ê³  í•©ë‹ˆë‹¤.
// (ìŠ¤ì¼€ì¤„ëœ íƒ€ì´ë¨¸ì˜ ìˆ˜ì— ì˜í•´ ì„±ëŠ¥ì´ ì˜í–¥ì„ ë°›ì§€ ì•Šë„ë¡)
//
// ë°€ë¦¬ì´ˆ ë‹¨ìœ„ì˜ ì§€ì† ì‹œê°„ì„ í‚¤ë¡œ í•˜ëŠ” ë§í¬ë“œ ë¦¬ìŠ¤íŠ¸ë¥¼ í¬í•¨í•˜ëŠ” ê°ì²´ ë§µì„ ìœ ì§€í•©ë‹ˆë‹¤.
//
/* eslint-disable node-core/non-ascii-character */
//
// â•”â•â•â•â• > ê°ì²´ ë§µ
// â•‘
// â• â•â•
// â•‘ lists: { '40': { }, '320': { ... } } (ë°€ë¦¬ì´ˆ ë‹¨ìœ„ì˜ ì§€ì† ì‹œê°„ í‚¤)
// â•šâ•â•          â”Œâ”€â”€â”€â”€â”˜
//              â”‚
// â•”â•â•          â”‚
// â•‘ TimersList { _idleNext: { }, _idlePrev: (ìê¸° ìì‹ ) }
// â•‘         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
// â•‘    â•”â•â•  â”‚                              ^
// â•‘    â•‘    { _idleNext: { },  _idlePrev: { }, _onTimeout: (ì½œë°±) }
// â•‘    â•‘      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
// â•‘    â•‘      â”‚                                  ^
// â•‘    â•‘      { _idleNext: { ... },  _idlePrev: { }, _onTimeout: (ì½œë°±) }
// â• â•â•  â• â•â•
// â•‘    â•‘
// â•‘    â•šâ•â•â•â• > ì‹¤ì œ JavaScript íƒ€ì„ì•„ì›ƒë“¤
// â•‘
// â•šâ•â•â•â• > ë§í¬ë“œ ë¦¬ìŠ¤íŠ¸
//
//
// ì´ë¥¼ í†µí•´ JavaScript ë ˆì´ì–´ì—ì„œ ì‚¬ì‹¤ìƒ ìƒìˆ˜ ì‹œê°„ì˜ ì‚½ì…(ì¶”ê°€), ì œê±°, íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
// í•˜ë‚˜ì˜ íƒ€ì´ë¨¸ ë¦¬ìŠ¤íŠ¸ëŠ” í•´ë‹¹ ë¦¬ìŠ¤íŠ¸ì— ë‹¨ìˆœíˆ ì¶”ê°€í•˜ì—¬ ì •ë ¬ë  ìˆ˜ ìˆëŠ”ë°,
// ê·¸ ì•ˆì˜ ëª¨ë“  íƒ€ì´ë¨¸ê°€ ë™ì¼í•œ ì§€ì† ì‹œê°„ì„ ê³µìœ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
// ë”°ë¼ì„œ ë‚˜ì¤‘ì— ì¶”ê°€ëœ íƒ€ì´ë¨¸ëŠ” í•­ìƒ ë‚˜ì¤‘ì— íƒ€ì„ì•„ì›ƒë˜ë„ë¡ ìŠ¤ì¼€ì¤„ë˜ë¯€ë¡œ,
// ë‹¨ìˆœíˆ ì¶”ê°€ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.
// ê°ì²´ ì†ì„± ë§í¬ë“œ ë¦¬ìŠ¤íŠ¸ì—ì„œì˜ ì œê±°ë„ lib/internal/linkedlist.js êµ¬í˜„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´
// ì‚¬ì‹¤ìƒ ìƒìˆ˜ ì‹œê°„ì…ë‹ˆë‹¤.
// íƒ€ì„ì•„ì›ƒì€ í˜„ì¬ ë§Œë£Œë  ì˜ˆì •ì¸ íƒ€ì´ë¨¸ë§Œ ì²˜ë¦¬í•˜ë©´ ë˜ë©°, ì´ëŠ” ìœ„ì—ì„œ ì–¸ê¸‰í•œ ì´ìœ ë¡œ í•­ìƒ
// ë¦¬ìŠ¤íŠ¸ì˜ ì‹œì‘ ë¶€ë¶„ì— ìˆìŠµë‹ˆë‹¤. ì•„ì§ íƒ€ì„ì•„ì›ƒë  í•„ìš”ê°€ ì—†ëŠ” ì²« ë²ˆì§¸ íƒ€ì´ë¨¸ ì´í›„ì˜
// íƒ€ì´ë¨¸ë“¤ë„ í•­ìƒ ë‚˜ì¤‘ì— íƒ€ì„ì•„ì›ƒë  ì˜ˆì •ì…ë‹ˆë‹¤.
//
// ë”°ë¼ì„œ ìƒìˆ˜ ì‹œê°„ë³´ë‹¤ ê¸´ ì—°ì‚°ì€ ë‘ ê³³ì— í¬í•¨ë©ë‹ˆë‹¤:
// ìš°ì„ ìˆœìœ„ í â€” ëª¨ë“  ì—°ì‚°ì„ ìµœì•…ì˜ ê²½ìš° O(log n) ì‹œê°„ì— ìˆ˜í–‰í•˜ëŠ” íš¨ìœ¨ì ì¸
// ì´ì§„ í™ êµ¬í˜„ â€” ëŠ” ë§Œë£Œë  íƒ€ì„ì•„ì›ƒ ë¦¬ìŠ¤íŠ¸ì˜ ìˆœì„œë¥¼ ê´€ë¦¬í•˜ê³ ,
// íŠ¹ì • ì§€ì† ì‹œê°„ì˜ íƒ€ì´ë¨¸ê°€ í¬í•¨ëœ íŠ¹ì • ë¦¬ìŠ¤íŠ¸ë¥¼ ê°ì²´ ë§µì—ì„œ ì¡°íšŒí•˜ê±°ë‚˜
// (ë˜ëŠ” ìƒˆ ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±) í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ ì—°ì‚°ë“¤ì€ ë‹¤ë¥¸ íƒ€ì´ë¨¸ ì•„í‚¤í…ì²˜ì— ë¹„í•´
// ì‚¬ì†Œí•œ ê²ƒìœ¼ë¡œ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤.

```

ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¡œ êµ¬í˜„ëœ íƒ€ì´ë¨¸ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ ì™¸ì—ë„ ë‹¤ì–‘í•œ íƒ€ì„ì•„ì›ƒ ì´ë²¤íŠ¸ ì²˜ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš©ëœë‹¤. ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ìœ„í•œ ë¶€ë¶„ì— ì¢€ ë” ì§‘ì¤‘í•´ë³´ì. `libuv`ì˜ [íƒ€ì´ë¨¸ êµ¬í˜„ì²´](https://github.com/nodejs/node/blob/main/deps/uv/src/timer.c)ë¥¼ ë³´ë©´, ìµœì†Œ ì´ì§„ í™ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ë§ í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. íƒ€ì´ë¨¸ í˜ì´ì¦ˆì— ë„ë‹¬í•  ë•Œë§ˆë‹¤ ë„ë‹¬í•œ ì‹œê°ì„ ê¸°ë¡í•˜ê³ , í™ ë£¨íŠ¸ë¥¼ ë³´ê³ , íƒ€ì´ë¨¸ í˜ì´ì¦ˆì— ë„ë‹¬í•œ ì‹œê° ì´ì „ ì‘ì—…ë“¤ì„ ëª¨ë‘ êº¼ë‚´ì–´ ì‹¤í–‰í•œë‹¤ê³  ë³´ë©´ ëœë‹¤. ì´ëŸ¬í•œ ì´ìœ ë¡œ, `setTimeout(()=>{}, 1000)`ì€ 1ì´ˆ ì´í›„ ì‹¤í–‰ì„ ë³´ì¥í•  ë¿, ì •í™•íˆ 1ì´ˆ í›„ì— ì‹¤í–‰ë¨ì„ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤. 

### Pending

Pending PhaseëŠ” ì´ì „ì— ë°œìƒí•œ ì¼ë¶€ ì‹œìŠ¤í…œ ì‘ì—…ì— ëŒ€í•œ ì½œë°±ì„ ì²˜ë¦¬í•˜ëŠ” ë‹¨ê³„ì´ë‹¤. íŠ¹íˆ íŠ¹ì • ì¢…ë¥˜ì˜ TCP ì˜¤ë¥˜ì™€ ê°™ì€ ì‹œìŠ¤í…œ ì‘ì—…ì— ëŒ€í•œ ì½œë°±ì´ ì´ ë‹¨ê³„ì—ì„œ ì‹¤í–‰ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´, TCP ì†Œì¼“ì´ `ECONNREFUSED` ì˜¤ë¥˜ë¥¼ ë°›ì•˜ì„ ë•Œ, ì¼ë¶€ ìœ ë‹‰ìŠ¤ ì‹œìŠ¤í…œì—ì„œëŠ” ì´ ì˜¤ë¥˜ë¥¼ ë³´ê³ í•˜ê¸° ì „ì— ì ì‹œ ëŒ€ê¸°í•´ì•¼ í•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ê²½ìš° í•´ë‹¹ ì˜¤ë¥˜ê°€ Pending Phaseì—ì„œ ì²˜ë¦¬ëœë‹¤. ì´ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬ë˜ëŠ” ì‘ì—…ë“¤ì€ Poll ë‹¨ê³„ì—ì„œ ì¦‰ì‹œ ì²˜ë¦¬ë˜ì§€ ëª»í•œ, ë˜ëŠ” ì§€ì—°ë˜ì–´ì•¼ í–ˆë˜ ì‹œìŠ¤í…œ ì‘ì—…ë“¤ì˜ ì½œë°±ì´ë‹¤. ì´ë¡œ ì¸í•´ Pending PhaseëŠ” ì‹œìŠ¤í…œ ìˆ˜ì¤€ì—ì„œ ì—°ê¸°ëœ ì‘ì—…ë“¤ì„ ë‹¤ì‹œ ì‹¤í–‰ ëŒ€ê¸° ìƒíƒœë¡œ ë§Œë“¤ì–´ì£¼ëŠ” ì¤‘ìš”í•œ ì—­í• ì„ í•œë‹¤. libuvì˜ `uv__run_pending` í•¨ìˆ˜ ì½”ë“œë¥¼ ë³´ë©´, `pending_queue`ì— ìˆëŠ” ì‘ì—…ë“¤ì„ í•˜ë‚˜ì”© êº¼ë‚´ì„œ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. ì´ ë‹¨ê³„ëŠ” íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ì´ë‚˜ ë„¤íŠ¸ì›Œí¬ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²½ìš°ì—ë„ ì²˜ë¦¬ë  ìˆ˜ ìˆë‹¤.

```cpp
static void uv__run_pending(uv_loop_t* loop) {
  struct uv__queue* q;
  struct uv__queue pq;
  uv__io_t* w;
  
  uv__queue_move(&loop->pending_queue, &pq);
  while (!uv__queue_empty(&pq)) {
    q = uv__queue_head(&pq);
    uv__queue_remove(q);
    uv__queue_init(q);
    w = uv__queue_data(q, uv__io_t, pending_queue);
    w->cb(loop, w, POLLOUT);
  }
}
```

### Idle, Prepare

ê³µì‹ ë¬¸ì„œì—ì„  ì´ í˜ì´ì¦ˆì— ëŒ€í•œ ì„¤ëª…ì´ ì—†ë‹¤. ì´ ë‹¨ê³„ì—ì„œëŠ” ì´ë²¤íŠ¸ ë£¨í”„ ë‚´ë¶€ì—ì„œ íŠ¹ì • ì‘ì—…ì´ ì¤€ë¹„ë  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì‘ì—…ë“¤ì´ ìˆ˜í–‰ëœë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ì ì½”ë“œì—ì„œ ì§ì ‘ ì´ ë‹¨ê³„ë¥¼ í™œìš©í•˜ê±°ë‚˜ ê´€ë ¨ëœ ì‘ì—…ì„ ìˆ˜í–‰í•  ì¼ì€ ì—†ì§€ë§Œ, libuvë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ì—ì„œëŠ” ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” ë‚´ë¶€ì ì¸ ì¤€ë¹„ ë‹¨ê³„ë¥¼ ë§í•œë‹¤.

ì´ê±° ì°¾ëŠë¼ ë„ˆë¬´ í˜ë“¤ì—ˆë‹¤... ë§¤í¬ë¡œ ê¸°ëŠ¥ìœ¼ë¡œ ë™ì ìœ¼ë¡œ ì •ì˜ëœë‹¤. 

```c
#define UV_LOOP_WATCHER_DEFINE(name, type)                                    \
  int uv_##name##_init(uv_loop_t* loop, uv_##name##_t* handle) {              \
    uv__handle_init(loop, (uv_handle_t*)handle, UV_##type);                   \
    handle->name##_cb = NULL;                                                 \
    return 0;                                                                 \
  }                                                                           \
                                                                              \
  int uv_##name##_start(uv_##name##_t* handle, uv_##name##_cb cb) {           \
    if (uv__is_active(handle)) return 0;                                      \
    if (cb == NULL) return UV_EINVAL;                                         \
    uv__queue_insert_head(&handle->loop->name##_handles, &handle->queue);     \
    handle->name##_cb = cb;                                                   \
    uv__handle_start(handle);                                                 \
    return 0;                                                                 \
  }                                                                           \
                                                                              \
  int uv_##name##_stop(uv_##name##_t* handle) {                               \
    if (!uv__is_active(handle)) return 0;                                     \
    uv__queue_remove(&handle->queue);                                         \
    uv__handle_stop(handle);                                                  \
    return 0;                                                                 \
  }                                                                           \
                                                                              \
  void uv__run_##name(uv_loop_t* loop) {                                      \
    uv_##name##_t* h;                                                         \
    struct uv__queue queue;                                                   \
    struct uv__queue* q;                                                      \
    uv__queue_move(&loop->name##_handles, &queue);                            \
    while (!uv__queue_empty(&queue)) {                                        \
      q = uv__queue_head(&queue);                                             \
      h = uv__queue_data(q, uv_##name##_t, queue);                            \
      uv__queue_remove(q);                                                    \
      uv__queue_insert_tail(&loop->name##_handles, q);                        \
      h->name##_cb(h);                                                        \
    }                                                                         \
  }                                                                           \
                                                                              \
  void uv__##name##_close(uv_##name##_t* handle) {                            \
    uv_##name##_stop(handle);                                                 \
  }

UV_LOOP_WATCHER_DEFINE(prepare, PREPARE)
UV_LOOP_WATCHER_DEFINE(check, CHECK)
UV_LOOP_WATCHER_DEFINE(idle, IDLE)
```

ë§ˆì§€ë§‰ 3ì¤„ì„ ì˜ ë³´ë©´, *Prepare*, *Idle*, *Check* ì˜ êµ¬í˜„ì€ ìœ„ ë§¤í¬ë¡œì— ì˜ì¡´í•˜ê³  ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìœ¼ë©°, ê° êµ¬í˜„ì€ ê·¸ì € ê° ë‹¨ê³„ì˜ íë¥¼ í™•ì¸í•˜ì—¬ ì²˜ë¦¬í•˜ëŠ” ì‘ì—…ì¼ ë¿ì´ë‹¤.

### Poll

Poll ë‹¨ê³„ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ì˜ ê°€ì¥ ì¤‘ìš”í•œ í˜ì´ì¦ˆ ì¤‘ í•˜ë‚˜ì´ë‹¤. ì´ ë‹¨ê³„ì—ì„œ ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ìƒˆë¡œìš´ I/O ì´ë²¤íŠ¸ë¥¼ ê¸°ë‹¤ë¦°ë‹¤. ë§Œì•½ ëŒ€ê¸° ì¤‘ì¸ I/O ì‘ì—…ì´ ìˆë‹¤ë©´ í•´ë‹¹ ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ê³ , ì™„ë£Œëœ ì‘ì—…ì— ëŒ€í•œ ì½œë°±ì„ ì‹¤í–‰í•œë‹¤. ì´ ë‹¨ê³„ì—ì„œ ì´ë²¤íŠ¸ ë£¨í”„ëŠ” íŠ¹ì • íƒ€ì„ì•„ì›ƒ ë™ì•ˆ ìƒˆë¡œìš´ ì´ë²¤íŠ¸ë¥¼ ê¸°ë‹¤ë¦¬ë©°, ì´ íƒ€ì„ì•„ì›ƒ ë‚´ì— ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°„ë‹¤. ì´ëŸ¬í•œ Poll ë‹¨ê³„ê°€ ë°”ë¡œ Node.jsê°€ íš¨ìœ¨ì ìœ¼ë¡œ ë§ì€ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ì´ìœ  ì¤‘ í•˜ë‚˜ì´ë‹¤. ì´ ë‹¨ê³„ì—ì„œ ëŒ€ê¸° ì‹œê°„ì´ ì ì ˆíˆ ì¡°ì •ë˜ë©´ ë§ì€ ì–‘ì˜ ë™ì‹œ ìš”ì²­ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

ì´ ë¶€ë¶„ì€ ìš´ì˜ì²´ì œì— ë”°ë¼ ì„¸ë¶€ êµ¬í˜„ì´ ë§ì´ ë‹¤ë¥´ë‹¤. ê¶ê¸ˆí•˜ë‹¤ë©´ ì•„ë˜ íŒŒì¼ë“¤ì„ ì§ì ‘ ì°¸ê³ í•˜ì. Windows êµ¬í˜„ì€ `deps/uv/src/windows/poll.c` ì— ìˆë‹¤.

![image](https://github.com/user-attachments/assets/4e5e352c-73b9-42cc-8c17-fdc2c94fdca1)

### Check

Check ë‹¨ê³„ì—ì„œëŠ” `setImmediate()`ë¡œ ë“±ë¡ëœ ì½œë°±ë“¤ì´ ì‹¤í–‰ëœë‹¤. ì´ ì½œë°±ë“¤ì€ Poll í˜ì´ì¦ˆê°€ ëë‚˜ê³  ë‚˜ì„œ ë°”ë¡œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ë§¤ìš° ë¹ ë¥¸ ì‘ë‹µì„±ì„ í•„ìš”ë¡œ í•˜ëŠ” ê²½ìš° ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤. `setImmediate()`ì™€ `setTimeout()`ì˜ ì°¨ì´ì ì€ ë°”ë¡œ ì´ ì´ë²¤íŠ¸ ë£¨í”„ ë‹¨ê³„ì—ì„œì˜ ì²˜ë¦¬ ìˆœì„œ ì°¨ì´ì´ë‹¤. `setImmediate()`ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ì˜ Check í˜ì´ì¦ˆì—ì„œ ì²˜ë¦¬ë˜ê³ , `setTimeout()`ì€ Timers í˜ì´ì¦ˆì—ì„œ ì²˜ë¦¬ëœë‹¤. 

[ì‹¤ì œ êµ¬í˜„]( https://github.com/nodejs/node/blob/c35cbcde4b7c8821587ad96d0e69942c01ace23d/lib/internal/timers.js#L292)ì„ ë³´ë©´, `setImmediate()`ëŠ” ì•„ì˜ˆ ë”°ë¡œ ê´€ë¦¬í•¨ì„ ì•Œ ìˆ˜ ìˆë‹¤.

ìœ„ ì„œìˆ ì„ ë³´ê³  `setTimeout(()=>{}, 0)` ê³¼ `setImmediate(()=>{})` ì˜ ì‹¤í–‰ ìˆœì„œë¥¼ ë¹„êµí•  ë•Œ í•­ìƒ ì „ìê°€ í•­ìƒ ë¹ ë¥´ë‹¤ê³  í•˜ëŠ” ì„œìˆ ì´ ìˆëŠ”ë°, ì´ëŠ” í‹€ë¦° ì„œìˆ ì´ë‹¤. ì•„ë˜ ì½”ë“œë¥¼ ë°˜ë³µí•´ì„œ ì‹¤í–‰í•´ë³´ë©´, ë¡œê·¸ ìˆœì„œê°€ ë§¤ë²ˆ ë’¤ë°”ë€ŒëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

```js
setTimeout(() => {
     console.log('setTimeout');
 }, 0);
setImmediate(() => {
    console.log('setImmediate');
});
```

![image](https://github.com/user-attachments/assets/f1e3c2d3-0b1b-4683-9851-ce9cc00794df)

ì´ëŠ” ì‹¤í–‰ë˜ëŠ” ì»¨í…ìŠ¤íŠ¸ê°€ ë©”ì¸ ëª¨ë“ˆì´ê¸° ë•Œë¬¸ì¸ë°, ë©”ì¸ ëª¨ë“ˆì´ ì‹¤í–‰ë˜ê³  ë‚˜ì„œ ì´ë²¤íŠ¸ ë£¨í”„ê°€ Timer í˜ì´ì¦ˆì— ë„ë‹¬í•  ë•Œ `setTimeout`ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ëœ íƒ€ì´ë¨¸ë¥¼ ì°¾ì§€ ëª»í•  ìˆ˜ë„ ìˆë‹¤. `setTimeout`ì´ í˜¸ì¶œë˜ëŠ” ìˆœê°„ íƒ€ì´ë¨¸ë¥¼ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ëŠ” ê³¼ì •ì—ì„œ OSì˜ ìŠ¤ì¼€ì¤„ë§ ë“± ë‹¤ì–‘í•œ ì¸í„°ëŸ½íŠ¸ê°€ ê±¸ë¦´ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤. 

í•˜ì§€ë§Œ ìœ„ ì½”ë“œë¥¼ I/O ì‘ì—…ì˜ ì½œë°±ìœ¼ë¡œ ë„£ì–´ì£¼ë©´, ì‹¤í–‰ ìˆœì„œê°€ ë³´ì¥ëœë‹¤. I/O ì‘ì—…ì˜ ì½œë°±ì€ Pending í˜ì´ì¦ˆì—ì„œ ì²˜ë¦¬ëœë‹¤. Pending í˜ì´ì¦ˆì—ì„œ `setTimeout` ê³¼ `setImmediate` ë¥¼ ì‹¤í–‰í•˜ì—¬ íƒ€ì´ë¨¸ë¥¼ ë“±ë¡í•œ í›„ ê³„ì† ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ì§„í–‰í•˜ë‹¤ ë³´ë©´, ë°˜ë“œì‹œ Timers í˜ì´ì¦ˆë³´ë‹¤ Check í˜ì´ì¦ˆì— ë¨¼ì € ë„ë‹¬í•˜ê²Œ ë˜ê¸° ë•Œë¬¸ì— `setImmediate`ì˜ ì½œë°± ì‹¤í–‰ì´ ë¨¼ì € ì´ë¤„ì§„ë‹¤ê³  ìˆœì„œë¥¼ ë³´ì¥í•  ìˆ˜ ìˆë‹¤.

### Close callbacks 

ë§ˆì§€ë§‰ìœ¼ë¡œ Close ì½œë°± í˜ì´ì¦ˆì—ì„œëŠ” `close`, `destroy` ì´ë²¤íŠ¸ì™€ ê´€ë ¨ëœ ì‘ì—…ë“¤ì´ ì‹¤í–‰ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì†Œì¼“ì´ ë‹«íˆëŠ” ìƒí™©ì—ì„œ ì´ì™€ ê´€ë ¨ëœ í´ë¦°ì—… ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ê²½ìš°ê°€ í•´ë‹¹ëœë‹¤. ì†Œì¼“ì´ë‚˜ í•¸ë“¤ì´ ë‹«íˆë©´ì„œ ì¶”ê°€ì ì¸ ìì› í•´ì œ ì‘ì—…ì´ í•„ìš”í•  ë•Œ ì´ ë‹¨ê³„ê°€ ì‹¤í–‰ë˜ë©°, ì´ë¥¼ í†µí•´ ìì› ëˆ„ìˆ˜ ì—†ì´ í´ë¦°ì—…ì„ ì™„ë£Œí•  ìˆ˜ ìˆë‹¤.

```cpp
static void uv__run_closing_handles(uv_loop_t* loop) {
  uv_handle_t* p;
  uv_handle_t* q;
  p = loop->closing_handles;
  loop->closing_handles = NULL;
  
  while (p) {
    q = p->next_closing;
    uv__finish_close(p);
    p = q;
  }
}
```
## nextTickQueue ì™€ microTaskQueue

ìœ„ 6ê°œì˜ í˜ì´ì¦ˆì— ëŒ€í•´ ì´í•´í–ˆë‹¤ë©´, í•˜ë‚˜ì˜ ì˜ë¬¸ì´ ë“¤ ìˆ˜ ìˆë‹¤. ëŒ€ì²´ `Promise`ì˜ ì½œë°±ì€ ì–´ë””ì„œ ì²˜ë¦¬ë˜ëŠ” ê±¸ê¹Œ?
ì´ ë¶€ë¶„ì€ Node.js ì´ë²¤íŠ¸ ë£¨í”„ì˜ ë‹¤ë¥¸ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë°œìƒí•œë‹¤. ì´ëŸ¬í•œ ì‘ì—…ë“¤ì€ ë°”ë¡œ **microTaskQueue**ì™€ **nextTickQueue**ì—ì„œ ì²˜ë¦¬ëœë‹¤. ì´ ë‘ ê°€ì§€ íëŠ” ì´ë²¤íŠ¸ ë£¨í”„ì˜ ì¼ë°˜ì ì¸ íë¦„ê³¼ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‘ë™í•˜ì—¬, íŠ¹ì • ì‘ì—…ì„ ìš°ì„ ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ë° ì¤‘ìš”í•œ ì—­í• ì„ í•œë‹¤. ìœ„ì—ì„œ ì„¤ëª…í•œ ì´ë²¤íŠ¸ ë£¨í”„ì˜ ê° í˜ì´ì¦ˆë¥¼ ì§€ë‚  ë•Œë§ˆë‹¤ ë‘ ê°œì˜ íë¥¼ ë³´ê³  ì‘ì—…ì„ ì²˜ë¦¬í•œë‹¤. [êµ¬í˜„ì²´ ì½”ë“œ](https://github.com/nodejs/node/blob/c35cbcde4b7c8821587ad96d0e69942c01ace23d/lib/internal/process/task_queues.js#L72)ë¥¼ ì‚´í´ë³´ì.

```js
function processTicksAndRejections() {
  let tock;
  do {
    while ((tock = queue.shift()) !== null) {
      const priorContextFrame =
        AsyncContextFrame.exchange(tock[async_context_frame]);

      const asyncId = tock[async_id_symbol];
      emitBefore(asyncId, tock[trigger_async_id_symbol], tock);

      try {
        const callback = tock.callback;
        if (tock.args === undefined) {
          callback();
        } else {
          const args = tock.args;
          switch (args.length) {
            case 1: callback(args[0]); break;
            case 2: callback(args[0], args[1]); break;
            case 3: callback(args[0], args[1], args[2]); break;
            case 4: callback(args[0], args[1], args[2], args[3]); break;
            default: callback(...args);
          }
        }
      } finally {
        if (destroyHooksExist())
          emitDestroy(asyncId);
      }

      emitAfter(asyncId);

      AsyncContextFrame.set(priorContextFrame);
    }
    runMicrotasks();
  } while (!queue.isEmpty() || processPromiseRejections());
  setHasTickScheduled(false);
  setHasRejectionToWarn(false);
}
```

`do-while` ë¬¸ ë‚´ë¶€ while-loop ë¶€ë¶„ì´ **nextTickQueue** ì— ë“¤ì–´ê°„ ì‘ì—…ë“¤ì„ ì²˜ë¦¬í•˜ëŠ” ë¶€ë¶„ì´ê³ , `runMicrotasks()`ê°€ **nextTickQueue**ì— ë“¤ì–´ê°„ ì‘ì—…ë“¤ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.

### V8ì˜ microTaskQueue

ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë¹„ë™ê¸° ì‘ì—… ì¤‘, **Promise**ì™€ ê°™ì€ ë¹„ë™ê¸° ì‘ì—…ì€ **microtasks**ë¡œ ë¶„ë¥˜ëœë‹¤. ì´ëŸ¬í•œ microtasksëŠ” **V8 ì—”ì§„**ì´ ê´€ë¦¬í•˜ëŠ” **microTaskQueue**ì— ì €ì¥ë˜ë©°, ì´ë²¤íŠ¸ ë£¨í”„ì˜ ê° í˜ì´ì¦ˆê°€ ì¢…ë£Œë  ë•Œë§ˆë‹¤ ì‹¤í–‰ëœë‹¤. ì¦‰, ì´ë²¤íŠ¸ ë£¨í”„ì˜ ê° ë‹¨ê³„ì—ì„œ ë°œìƒí•œ ì‘ì—…ë“¤ì´ ë§ˆë¬´ë¦¬ë˜ê¸° ì „ì—, í•´ë‹¹ ë‹¨ê³„ì—ì„œ ë°œìƒí•œ microtaskë“¤ì´ ëª¨ë‘ ì²˜ë¦¬ë˜ëŠ” ë°©ì‹ì´ë©°, **V8** ì—”ì§„ì´ ê´€ë¦¬í•˜ëŠ” ë¶€ë¶„ì´ê¸° ë•Œë¬¸ì— ìœ„ ì½”ë“œ ìŠ¤ë‹ˆí«ì—ì„œëŠ” í•¨ìˆ˜ í˜¸ì¶œ í˜•íƒœë¡œ ì‘ì„±ë˜ì–´ ìˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, `Promise.resolve().then(() => { ... })`ì™€ ê°™ì€ ì½”ë“œëŠ” ì´ë²¤íŠ¸ ë£¨í”„ì˜ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ê¸° ì „ì— **microTaskQueue**ì— ìŒ“ì¸ ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ì‹¤í–‰ëœë‹¤. ì´ëŠ” ì¼ë°˜ì ì¸ ì´ë²¤íŠ¸ ë£¨í”„ì˜ í˜ì´ì¦ˆë³´ë‹¤ ë†’ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§€ê¸° ë•Œë¬¸ì—, ë¹„ë™ê¸° ì‘ì—…ì´ ë§¤ìš° ë¹ ë¥´ê²Œ ì‹¤í–‰ë  ìˆ˜ ìˆê²Œ í•œë‹¤.

### Node.jsì˜ nextTickQueue (`process.nextTick()`)

Node.jsëŠ” ë¸Œë¼ìš°ì €ì™€ëŠ” ë³„ë„ë¡œ, **nextTick queue**ë¼ëŠ” ë³„ë„ì˜ íë¥¼ ê°€ì§€ê³  ìˆë‹¤. ì´ íëŠ” ì´ë²¤íŠ¸ ë£¨í”„ê°€ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ê¸° ì „ì— ì²˜ë¦¬í•´ì•¼ í•  ì‘ì—…ë“¤ì„ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤. `process.nextTick()`ì€ ì´ë¥¼ í†µí•´ íŠ¹ì • ì‘ì—…ì„ **ì¦‰ì‹œ ì²˜ë¦¬**í•  ìˆ˜ ìˆëŠ” ë©”ì»¤ë‹ˆì¦˜ì„ ì œê³µí•œë‹¤.

`process.nextTick()`ì€ ì´ë²¤íŠ¸ ë£¨í”„ì˜ ê° í˜ì´ì¦ˆê°€ ì™„ë£Œë˜ê¸° ì „ì— í•­ìƒ ìš°ì„ ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤. ì´ëŠ” ì¼ë°˜ì ì¸ microtaskë³´ë‹¤ë„ ìš°ì„  ìˆœìœ„ê°€ ë†’ì•„, ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œì—ì„œ **ê°€ì¥ ë¨¼ì € ì‹¤í–‰**ë˜ì–´ì•¼ í•˜ëŠ” ì‘ì—…ì„ ìŠ¤ì¼€ì¤„ë§í•  ë•Œ ì‚¬ìš©ëœë‹¤. ì´ë¡œ ì¸í•´ ì´ë²¤íŠ¸ ë£¨í”„ì˜ í˜ì´ì¦ˆê°€ ì§„í–‰ë˜ê¸° ì „ì—, `nextTick`ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ëœ ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œëœë‹¤. ì•„ë˜ ì½”ë“œë¥¼ ì‚´í´ë³´ì.

```js
process.nextTick(() => {
  console.log('nextTick');
});
Promise.resolve().then(() => {
  console.log('Promise');
});
console.log('main');
```

ì¶œë ¥ ìˆœì„œëŠ” *main* -> *nextTick* -> *Promise* ì´ë‹¤. `process.nextTick`ì˜ ì½œë°± í•¨ìˆ˜ë¥¼ `nextTickQueue`ì— ë“±ë¡í•˜ê³ , Promiseì˜ resolve ì½œë°±ì„ `microTaskQueue`ì— ë“±ë¡í•œë‹¤. ê·¸ëŸ° ë‹¤ìŒ *main*ì´ ì¶œë ¥ë˜ê³ , ì²˜ë¦¬ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ `nextTickQueue`ê°€ ë¨¼ì € ì†Œë¹„ëœë‹¤.  `process.nextTick()`ì€ ì´ë²¤íŠ¸ ë£¨í”„ì˜ ê° í˜ì´ì¦ˆê°€ ì™„ë£Œë˜ê¸° ì „ì— ì‹¤í–‰ë˜ë¯€ë¡œ, í•­ìƒ `Promise`ë³´ë‹¤ ìš°ì„ í•˜ì—¬ ëœë‹¤. ë”°ë¼ì„œ, ì´ ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•  ë•ŒëŠ” ì£¼ì˜ê°€ í•„ìš”í•˜ë‹¤. `nextTick`ì„ ê³¼ë„í•˜ê²Œ ì‚¬ìš©í•˜ë©´ ì´ë²¤íŠ¸ ë£¨í”„ì˜ ë‹¤ìŒ í˜ì´ì¦ˆë¡œ ë„˜ì–´ê°€ì§€ ëª»í•˜ê³ , ê³„ì†í•´ì„œ `nextTick` íì— ìŒ“ì¸ ì‘ì—…ë“¤ì„ ì²˜ë¦¬í•˜ê²Œ ë˜ì–´ **ë¬´í•œ ë£¨í”„**ì— ë¹ ì§ˆ ìˆ˜ ìˆë‹¤.

êµ¬í˜„ì²´ ì½”ë“œëŠ” [ì—¬ê¸°](https://github.com/nodejs/node/blob/c35cbcde4b7c8821587ad96d0e69942c01ace23d/lib/internal/process/task_queues.js#L113)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆë‹¤.

```js
function nextTick(callback) {
  validateFunction(callback, 'callback');

  if (process._exiting)
    return;

  let args;
  switch (arguments.length) {
    case 1: break;
    case 2: args = [arguments[1]]; break;
    case 3: args = [arguments[1], arguments[2]]; break;
    case 4: args = [arguments[1], arguments[2], arguments[3]]; break;
    default:
      args = new Array(arguments.length - 1);
      for (let i = 1; i < arguments.length; i++)
        args[i - 1] = arguments[i];
  }

  if (queue.isEmpty())
    setHasTickScheduled(true);
  const asyncId = newAsyncId();
  const triggerAsyncId = getDefaultTriggerAsyncId();
  const tickObject = {
    [async_id_symbol]: asyncId,
    [trigger_async_id_symbol]: triggerAsyncId,
    [async_context_frame]: AsyncContextFrame.current(),
    callback,
    args,
  };
  if (initHooksExist())
    emitInit(asyncId, 'TickObject', triggerAsyncId, tickObject);
  queue.push(tickObject);
}
```

## Summary

[Introduction](#Introduction)ì—ì„œ ë³´ì•˜ë˜ `sleep`ê³¼ `sleepSync`ê°€ ì–´ë–¤ ì°¨ì´ê°€ ìˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆê²Œ ë˜ì—ˆê¸¸ ë°”ë€ë‹¤. `sleep`ì€ ì² ì €íˆ ì´ë²¤íŠ¸ ë£¨í”„ì˜ ê´€ë¦¬ë¥¼ ë°›ëŠ” í•¨ìˆ˜ì´ê³ , `sleepSync`ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ì˜ ë™ì‘ì„ ë§‰ì•„ë²„ë¦¬ëŠ”, *CPU-intensive* í•œ ì‘ì—…ì„ ë¬˜ì‚¬í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤. ì‹¤ì œë¡œ Node.jsë¥¼ ì‚¬ìš©í•  ë•Œì—ëŠ” ì´ëŸ¬í•œ ì‘ì—…ìœ¼ë¡œ ì¸í•´ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ë§‰ì§€ ì•Šë„ë¡, `worker-thread`ë“±ìœ¼ë¡œ ì‘ì—… íë¦„ ìì²´ë¥¼ ë¶„ë¦¬í•´ì£¼ì–´ì•¼ ê°•ì ì„ ì‚´ë¦´ ìˆ˜ ìˆë‹¤.

Node.jsì˜ ê°€ì¥ í° ê°•ì  ì¤‘ í•˜ë‚˜ëŠ” ë‹¨ì¼ ìŠ¤ë ˆë“œë¡œë„ ë†’ì€ ë™ì‹œì„±ì„ ì œê³µí•  ìˆ˜ ìˆëŠ” ì´ë²¤íŠ¸ ë£¨í”„ì´ë‹¤. ì´ ì´ë²¤íŠ¸ ë£¨í”„ëŠ” í¬ê²Œ 6ê°œì˜ ì£¼ìš” í˜ì´ì¦ˆ(Timers, Pending Callbacks, Idle/Prepare, Poll, Check, Close Callbacks)ë¡œ ë‚˜ë‰˜ë©°, ê° í˜ì´ì¦ˆëŠ” ë¹„ë™ê¸° ì‘ì—…ì˜ ë‹¤ì–‘í•œ ìœ í˜•ì„ ì²˜ë¦¬í•œë‹¤. ê° í˜ì´ì¦ˆì—ì„œ ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ëŠ”ì§€ êµ¬í˜„ì²´ ì½”ë“œì™€ í•¨ê»˜ ì‚´í´ë³´ì•˜ë‹¤. ë˜í•œ, ì´ë²¤íŠ¸ ë£¨í”„ì™€ ë³„ë„ë¡œ `nextTickQueue`ì™€ `microTaskQueue`ê°€ ì¡´ì¬í•˜ì—¬ ì‘ì—…ì˜ ìš°ì„  ìˆœìœ„ë¥¼ ì¡°ì •í•œë‹¤. ì´ëŸ¬í•œ êµ¬ì¡° ë•ë¶„ì— Node.jsëŠ” íš¨ìœ¨ì ì¸ I/O ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë©°, ëŒ€ê·œëª¨ì˜ ë™ì‹œ ì—°ê²°ì„ ìƒëŒ€ì ìœ¼ë¡œ ì ì€ ìì›ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤. ë‚˜ì²˜ëŸ¼ ì¶”ìƒí™”ëœ ê³„ì¸µì˜ ì„¸ë¶€ ë™ì‘ì´ ê¶ê¸ˆí–ˆë˜ ì‚¬ëŒë“¤ì—ê²Œ ë„ì›€ì´ ë˜ì—ˆê¸¸ ë°”ë€ë‹¤.

## References

[nodejs/node: Node.js JavaScript runtime âœ¨ğŸ¢ğŸš€âœ¨](https://github.com/nodejs/node)

[Node.js â€” Asynchronous flow control](https://nodejs.org/en/learn/asynchronous-work/asynchronous-flow-control)

[Node.js â€” Overview of Blocking vs Non-Blocking](https://nodejs.org/en/learn/asynchronous-work/overview-of-blocking-vs-non-blocking#concurrency-and-throughput)

[Node.js â€” The Node.js Event Loop](https://nodejs.org/en/learn/asynchronous-work/event-loop-timers-and-nexttick)

[Firing up the Ignition interpreter Â· V8](https://v8.dev/blog/ignition-interpreter)

[Node.js â€” Don't Block the Event Loop (or the Worker Pool)](https://nodejs.org/en/learn/asynchronous-work/dont-block-the-event-loop#should-you-read-this-guide)

[ì´ë²¤íŠ¸ ë£¨í”„ì™€ ë§¤í¬ë¡œíƒœìŠ¤í¬, ë§ˆì´í¬ë¡œíƒœìŠ¤í¬](https://ko.javascript.info/event-loop#ref-785)

[ë¡œìš° ë ˆë²¨ë¡œ ì‚´í´ë³´ëŠ” Node.js ì´ë²¤íŠ¸ ë£¨í”„](https://evan-moon.github.io/2019/08/01/nodejs-event-loop-workflow/#%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84%EB%8A%94-%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EC%97%94%EC%A7%84-%EB%82%B4%EB%B6%80%EC%97%90-%EC%9E%88%EB%8B%A4)

[Design overview - libuv documentation](https://docs.libuv.org/en/stable/design.html)
