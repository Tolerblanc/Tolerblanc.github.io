---
const currentPath = Astro.url.pathname;

const navItems = [
  { href: '/experimental', label: 'Home' },
  { href: '/experimental/blog', label: 'Blog' },
  { href: '/experimental/tags', label: 'Tags' },
  { href: '/experimental/about', label: 'About' },
];
---

<header class="header">
  <nav class="nav-container">
    <div class="nav-left">
      <a href="/experimental" class="logo">
        <span class="logo-text">인생은 B와 D사이 Code다</span>
      </a>
    </div>

    <div class="nav-center">
      <ul class="nav-links">
        {navItems.map(item => (
          <li>
            <a
              href={item.href}
              class={`nav-link ${currentPath === item.href || currentPath.startsWith(item.href + '/') ? 'active' : ''}`}
            >
              {item.label}
            </a>
          </li>
        ))}
      </ul>
    </div>

    <div class="nav-right">
      <button id="theme-toggle" class="theme-toggle" aria-label="다크 모드 토글">
        <svg class="theme-icon theme-icon-light" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 3V1M10 19V17M17 10H19M1 10H3M15.657 15.657L17.071 17.071M2.929 2.929L4.343 4.343M15.657 4.343L17.071 2.929M2.929 17.071L4.343 15.657" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2"/>
        </svg>
        <svg class="theme-icon theme-icon-dark" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" fill="currentColor"/>
        </svg>
      </button>
    </div>
  </nav>
</header>

<script>
  // 다크 모드 토글 스크립트
  const themeToggle = document.getElementById('theme-toggle');
  const html = document.documentElement;

  // 시스템 테마 감지 함수
  function getSystemTheme(): 'light' | 'dark' {
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }

  // 테마 적용 함수
  function applyTheme(theme: 'light' | 'dark' | 'system') {
    let actualTheme = theme;
    if (theme === 'system') {
      actualTheme = getSystemTheme();
    }

    if (actualTheme === 'dark') {
      html.classList.add('dark');
    } else {
      html.classList.remove('dark');
    }
  }

  // 초기 테마 설정: localStorage > 시스템 설정 > 기본값(light)
  const savedTheme = localStorage.getItem('theme') as 'light' | 'dark' | 'system' | null;
  const initialTheme = savedTheme || 'light';
  applyTheme(initialTheme);

  // 테마 토글 버튼 이벤트
  themeToggle?.addEventListener('click', () => {
    html.classList.toggle('dark');
    const isDark = html.classList.contains('dark');
    const newTheme = isDark ? 'dark' : 'light';
    localStorage.setItem('theme', newTheme);
  });

  // 시스템 테마 변경 감지 (사용자가 시스템 설정 선택한 경우)
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    const savedTheme = localStorage.getItem('theme');
    if (!savedTheme || savedTheme === 'system') {
      applyTheme(e.matches ? 'dark' : 'light');
    }
  });
</script>

<style>
  .header {
    position: fixed;
    top: 0;
    left: var(--layout-sidebar-width);
    right: 0;
    height: var(--layout-header-height);
    background-color: var(--color-bg-elevated);
    border-bottom: 1px solid var(--color-border-primary);
    z-index: var(--z-fixed);
    transition: background-color var(--transition-base), border-color var(--transition-base);
  }

  .nav-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 100%;
    padding: 0 var(--spacing-6);
    max-width: var(--layout-max-content-width);
    margin: 0 auto;
  }

  .nav-left {
    flex-shrink: 0;
  }

  .logo {
    display: flex;
    align-items: center;
    text-decoration: none;
    color: var(--color-text-primary);
    font-weight: var(--font-weight-bold);
    font-size: var(--font-size-lg);
    transition: color var(--transition-fast);
  }

  .logo:hover {
    color: var(--color-accent-primary);
  }

  .logo-text {
    display: none;
  }

  @media (min-width: 1024px) {
    .logo-text {
      display: inline;
    }
  }

  .nav-center {
    flex: 1;
    display: flex;
    justify-content: center;
  }

  .nav-links {
    display: flex;
    gap: var(--spacing-1);
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .nav-link {
    display: flex;
    align-items: center;
    padding: var(--spacing-2) var(--spacing-4);
    text-decoration: none;
    color: var(--color-text-secondary);
    border-radius: var(--radius-md);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    transition: all var(--transition-fast);
  }

  .nav-link:hover {
    background-color: var(--color-bg-secondary);
    color: var(--color-text-primary);
  }

  .nav-link.active {
    background-color: var(--color-accent-primary);
    color: #ffffff;
  }

  .nav-right {
    flex-shrink: 0;
  }

  .theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: none;
    background-color: var(--color-bg-secondary);
    color: var(--color-text-primary);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .theme-toggle:hover {
    background-color: var(--color-bg-tertiary);
  }

  .theme-icon {
    width: 20px;
    height: 20px;
  }

  .theme-icon-light {
    display: none;
  }

  .theme-icon-dark {
    display: block;
  }

  :global(html:not(.dark)) .theme-icon-light {
    display: block;
  }

  :global(html:not(.dark)) .theme-icon-dark {
    display: none;
  }

  /* Mobile: 헤더가 전체 너비 차지 */
  @media (max-width: 768px) {
    .header {
      left: 0;
    }
  }
</style>
