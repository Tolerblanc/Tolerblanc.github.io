---
// Reading progress indicator
---

<div id="reading-progress-container" class="fixed top-0 left-0 right-0 h-1 bg-transparent z-[100] pointer-events-none">
  <div id="reading-progress-bar" class="h-full w-0 bg-primary shadow-[0_0_10px_rgba(59,130,246,0.5)] transition-all duration-150 ease-out origin-left"></div>
</div>

<script>
  function initReadingProgress() {
    const progressBar = document.getElementById('reading-progress-bar');
    
    if (!progressBar) return;

    function updateProgress() {
      if (!progressBar) return;
      const scrollTotal = document.documentElement.scrollTop || document.body.scrollTop;
      const heightWin = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scroll = (scrollTotal / heightWin) * 100;

      const finalProgress = Math.min(Math.max(scroll, 0), 100);
      progressBar.style.width = `${finalProgress}%`;
    }

    // Optimize scroll event with requestAnimationFrame
    let ticking = false;
    const onScroll = () => {
        if (!ticking) {
            window.requestAnimationFrame(() => {
                updateProgress();
                ticking = false;
            });
            ticking = true;
        }
    };

    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', updateProgress, { passive: true });
    
    // Initial calculation
    updateProgress();
  }

  document.addEventListener('astro:page-load', initReadingProgress);
</script>
