---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { BlogPostCard } from '@/components/ui/blog-post-card';
import { Button } from '@/components/ui/button';
import { calculateReadingTime } from '@/utils/readingTime';
import { Book } from 'lucide-react';

const title = "인생은 B와 D사이 Code다";
const description = "Tolerblanc의 기술 블로그";

// Get all published blog posts with body content for reading time calculation
const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const posts = allPosts
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 6) // 최근 6개만 표시
  .map(post => ({
    ...post,
    readingTime: post.body ? calculateReadingTime(post.body) : '1분'
  }));
---

<BaseLayout title={title} description={description}>
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- Hero Section -->
    <section class="text-center mb-16 py-12">
      <h1 class="text-5xl md:text-6xl font-bold mb-4 bg-gradient-to-r from-primary to-primary/50 bg-clip-text text-transparent">
        인생은 B와 D사이 Code다
      </h1>
      <p class="text-xl text-muted-foreground mb-8">
        Tolerblanc의 기술 블로그
      </p>
    </section>

    <!-- Recent Posts -->
    <section class="mb-16">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-bold flex items-center gap-3">
          <Book size={28} />
          최근 포스트
        </h2>
        <Button variant="outline" asChild client:load>
          <a href="/blog">
            전체 보기 →
          </a>
        </Button>
      </div>

      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {posts.map((post) => (
          <BlogPostCard
            title={post.data.title}
            excerpt={post.data.excerpt}
            date={post.data.date}
            slug={post.id}
            categories={post.data.categories}
            tags={post.data.tags}
            readingTime={post.readingTime}
            client:load
          />
        ))}
      </div>
    </section>
  </div>
</BaseLayout>

