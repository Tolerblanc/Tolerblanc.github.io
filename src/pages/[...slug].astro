---
/**
 * Dynamic Blog Post Route
 *
 * URL 구조: /{category}/{slug}
 * 예: /javascript/nestjs-dematerializer-1
 *
 * Jekyll 호환 URL 패턴:
 * - Jekyll: /{category}/{slug}/
 * - Astro: /{category}/{slug}
 */

import { getCollection, type CollectionEntry, render } from 'astro:content';
import PostLayout from '@layouts/PostLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => {
    // draft가 아닌 포스트만 빌드
    return !data.draft;
  });

  return posts.map((post) => ({
    // post.id는 "javascript/nestjs-dematerializer-4" 형식
    // [...slug]로 받아서 "javascript/nestjs-dematerializer-4"로 매칭
    params: { slug: post.id },
    props: { post },
  }));
}

type Props = {
  post: CollectionEntry<'blog'>;
};

const { post } = Astro.props;
const { Content, headings } = await render(post);
---

<PostLayout post={post} headings={headings}>
  <Content
    components={{
      Notice: (await import('@components/Notice.astro')).default,
      Figure: (await import('@components/mdx/Figure.astro')).default,
      Steps: (await import('@components/mdx/Steps.astro')).default,
      LinkCard: (await import('@components/mdx/LinkCard.astro')).default,
      Toggle: (await import('@components/mdx/Toggle.astro')).default,
      FileTree: (await import('@components/mdx/FileTree.astro')).default,
      Folder: (await import('@components/mdx/Folder.astro')).default,
      File: (await import('@components/mdx/File.astro')).default,
      Tabs: (await import('@components/mdx/Tabs.astro')).default,
      TabItem: (await import('@components/mdx/TabItem.astro')).default,
    }}
  />
</PostLayout>
