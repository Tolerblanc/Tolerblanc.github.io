---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { Separator } from '@/components/ui/separator';
import { Tag } from 'lucide-react';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);

// 태그별로 포스트 수 계산
const tagCounts = new Map<string, number>();

allPosts.forEach(post => {
  post.data.tags.forEach(tag => {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  });
});

// 태그를 포스트 개수 순으로 정렬
const sortedTags = Array.from(tagCounts.entries())
  .sort((a, b) => b[1] - a[1])
  .map(([tag, count]) => ({ tag, count }));
---

<BaseLayout
  title="Tags - Tolerblanc's Blog"
  description="블로그의 모든 태그 목록"
  currentPath={Astro.url.pathname}
>
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <header class="mb-8">
      <div class="flex items-center gap-2 mb-4">
        <span class="text-sm text-muted-foreground flex items-center gap-1">
          <Tag className="w-4 h-4" />
          Tags
        </span>
      </div>
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h1 class="text-4xl md:text-5xl font-bold mb-3">
            Tags
          </h1>
          <p class="text-muted-foreground">
            {sortedTags.length}개의 태그
          </p>
        </div>
      </div>
    </header>

    <Separator className="mb-8" />

    <div class="flex flex-wrap gap-4 justify-center items-center py-8">
      {sortedTags.map(({ tag, count }) => {
        // 태그 크기를 포스트 수에 따라 조정 (최소 0.875rem, 최대 1.5rem)
        const maxCount = sortedTags[0].count;
        const minSize = 0.875;
        const maxSize = 1.5;
        const size = minSize + (count / maxCount) * (maxSize - minSize);

        return (
          <a
            href={`/tags/${tag}`}
            class="inline-flex items-center gap-2 px-4 py-2 bg-card border rounded-full text-muted-foreground transition-all hover:bg-secondary hover:border-primary hover:text-foreground hover:-translate-y-0.5 shadow-sm hover:shadow-md no-underline"
            style={`font-size: ${size}rem;`}
          >
            <span class="font-semibold">#{tag}</span>
            <span class="text-xs text-muted-foreground bg-secondary px-2 py-0.5 rounded-full font-semibold border group-hover:bg-primary group-hover:text-primary-foreground transition-colors group-hover:border-primary">
              {count}
            </span>
          </a>
        );
      })}
    </div>
  </div>
</BaseLayout>
