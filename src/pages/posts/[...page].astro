---
/**
 * Blog List with Pagination
 */

import { getCollection } from 'astro:content';
import type { GetStaticPaths, Page } from 'astro';
import type { CollectionEntry } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { BlogPostCard } from '@/components/ui/blog-post-card';
import { BlogPagination } from '@/components/ui/blog-pagination';
import { Separator } from '@/components/ui/separator';
import { calculateReadingTime } from '@/utils/readingTime';
import { BookOpen } from 'lucide-react';

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const allPosts = (await getCollection('blog', ({ data }) => !data.draft))
    .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

  // 페이지당 9개 포스트
  return paginate(allPosts, { pageSize: 9 });
};

type Props = {
  page: Page<CollectionEntry<'blog'>>;
};

const { page } = Astro.props;
const { data: posts, currentPage, lastPage } = page;

const title = currentPage === 1
  ? "블로그 - Tolerblanc's Blog"
  : `블로그 (${currentPage}/${lastPage}) - Tolerblanc's Blog`;
const description = "Tolerblanc의 기술 블로그 포스트 목록";
---

<BaseLayout title={title} description={description}>
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- Header -->
    <header class="mb-8">
       <div class="flex items-center gap-2 mb-4">
        <span class="text-sm text-muted-foreground flex items-center gap-1">
          <BookOpen size={16} />
          Blog
        </span>
      </div>
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h1 class="text-4xl md:text-5xl font-bold mb-3">
             All Posts
          </h1>
          <p class="text-muted-foreground">
             전체 {lastPage * 9 - (9 - posts.length)}개의 글이 있습니다.
          </p>
        </div>
      </div>
    </header>

    <Separator className="mb-8" />

    <!-- Post Grid -->
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {posts.map((post) => (
        <BlogPostCard
          title={post.data.title}
          excerpt={post.data.excerpt}
          date={post.data.date}
          slug={post.id}
          categories={post.data.categories}
          tags={post.data.tags}
          readingTime={post.body ? calculateReadingTime(post.body) : '1분'}
          client:load
        />
      ))}
    </div>

    <!-- Pagination -->
    <BlogPagination
      currentPage={currentPage}
      totalPages={lastPage}
      baseUrl="/posts"
      client:load
    />
  </div>
</BaseLayout>
