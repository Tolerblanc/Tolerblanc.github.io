---
/**
 * Blog List with Pagination
 *
 * URL êµ¬ì¡°:
 * - /experimental/blog â†’ ì²« í˜ì´ì§€
 * - /experimental/blog/2 â†’ ë‘ ë²ˆì§¸ í˜ì´ì§€
 * - /experimental/blog/3 â†’ ì„¸ ë²ˆì§¸ í˜ì´ì§€
 */

import { getCollection } from 'astro:content';
import type { GetStaticPaths, Page } from 'astro';
import type { CollectionEntry } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { BlogPostCard } from '@/components/ui/blog-post-card';
import { BlogPagination } from '@/components/ui/blog-pagination';
import { Separator } from '@/components/ui/separator';
import { calculateReadingTime } from '@/utils/readingTime';

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const allPosts = (await getCollection('blog', ({ data }) => !data.draft))
    .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

  // í˜ì´ì§€ë‹¹ 9ê°œ í¬ìŠ¤íŠ¸
  return paginate(allPosts, { pageSize: 9 });
};

type Props = {
  page: Page<CollectionEntry<'blog'>>;
};

const { page } = Astro.props;
const { data: posts, currentPage, lastPage, url } = page;

const title = currentPage === 1
  ? "ë¸”ë¡œê·¸ - Tolerblanc's Blog"
  : `ë¸”ë¡œê·¸ (${currentPage}/${lastPage}) - Tolerblanc's Blog`;
const description = "Tolerblancì˜ ê¸°ìˆ  ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ëª©ë¡";
---

<BaseLayout title={title} description={description}>
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- Header -->
    <header class="mb-12 text-center">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">
        ğŸ“š ë¸”ë¡œê·¸
      </h1>
      <p class="text-lg text-muted-foreground">
        ì´ {lastPage * 9 - (9 - posts.length)}ê°œì˜ í¬ìŠ¤íŠ¸
      </p>
    </header>

    <Separator className="mb-8" />

    <!-- Post Grid -->
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {posts.map((post) => (
        <BlogPostCard
          title={post.data.title}
          excerpt={post.data.excerpt}
          date={post.data.date}
          slug={post.id}
          categories={post.data.categories}
          tags={post.data.tags}
          readingTime={post.body ? calculateReadingTime(post.body) : '1ë¶„'}
          client:load
        />
      ))}
    </div>

    <!-- Pagination -->
    <BlogPagination
      currentPage={currentPage}
      totalPages={lastPage}
      baseUrl="/experimental/blog"
      client:load
    />
  </div>
</BaseLayout>

<style>
  /* ì¶”ê°€ ìŠ¤íƒ€ì¼ì´ í•„ìš”í•˜ë©´ ì—¬ê¸°ì— ì‘ì„± */
</style>
