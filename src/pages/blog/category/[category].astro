---
import { getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog', ({ data }) => !data.draft);

  // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê·¸ë£¹í™”
  const categoryMap = new Map<string, any[]>();

  allPosts.forEach(post => {
    const category = post.id.split('/')[0];
    if (!categoryMap.has(category)) {
      categoryMap.set(category, []);
    }
    categoryMap.get(category)!.push(post);
  });

  // ê° ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ ê²½ë¡œ ìƒì„±
  return Array.from(categoryMap.entries()).map(([category, posts]) => ({
    params: { category },
    props: {
      category,
      posts: posts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime()),
    },
  }));
}

const { category, posts } = Astro.props;

// ì¹´í…Œê³ ë¦¬ ë ˆì´ë¸” ë§¤í•‘
const categoryLabels: Record<string, { name: string; icon: string }> = {
  '9oormthon_challenge': { name: '9oormthon', icon: 'ğŸš€' },
  'algorithm': { name: 'Algorithm', icon: 'ğŸ§®' },
  'boj': { name: 'BOJ', icon: 'ğŸ’»' },
  'cpp': { name: 'C++', icon: 'âš™ï¸' },
  'dl': { name: 'Deep Learning', icon: 'ğŸ¤–' },
  'docker': { name: 'Docker', icon: 'ğŸ³' },
  'graphics': { name: 'Graphics', icon: 'ğŸ¨' },
  'javascript': { name: 'JavaScript', icon: 'ğŸ“œ' },
  'leetcode': { name: 'LeetCode', icon: 'ğŸ”¢' },
  'os': { name: 'OS', icon: 'ğŸ–¥ï¸' },
  'programmers': { name: 'Programmers', icon: 'ğŸ‘¨â€ğŸ’»' },
  'python': { name: 'Python', icon: 'ğŸ' },
  'retrospective': { name: 'Retrospective', icon: 'ğŸ“' },
  'review': { name: 'Review', icon: 'ğŸ“–' },
  'unix': { name: 'Unix', icon: 'ğŸ§' },
  'web_fundamentals': { name: 'Web Fundamentals', icon: 'ğŸŒ' },
  'í˜¼ê³µí•™ìŠµë‹¨': { name: 'í˜¼ê³µí•™ìŠµë‹¨', icon: 'ğŸ“š' },
};

const label = categoryLabels[category] || { name: category, icon: 'ğŸ“' };
---

<BaseLayout
  title={`${label.name} - Tolerblanc's Blog`}
  description={`${label.name} ì¹´í…Œê³ ë¦¬ì˜ ëª¨ë“  í¬ìŠ¤íŠ¸ (${posts.length}ê°œ)`}
  currentPath={Astro.url.pathname}
>
  <div class="category-page">
    <header class="category-header">
      <div class="category-icon">{label.icon}</div>
      <h1 class="category-title">{label.name}</h1>
      <p class="category-count">{posts.length}ê°œì˜ í¬ìŠ¤íŠ¸</p>
    </header>

    <div class="posts-grid">
      {posts.map((post) => (
        <article class="post-card">
          <a href={`/experimental/blog/${post.id}`}>
            <div class="post-card-header">
              <h2 class="post-card-title">{post.data.title}</h2>
              <time class="post-card-date" datetime={post.data.date.toISOString()}>
                {post.data.date.toLocaleDateString('ko-KR', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                })}
              </time>
            </div>

            {post.data.excerpt && (
              <p class="post-card-excerpt">{post.data.excerpt}</p>
            )}

            {post.data.tags && post.data.tags.length > 0 && (
              <div class="post-card-tags">
                {post.data.tags.slice(0, 5).map((tag: string) => (
                  <span class="tag">#{tag}</span>
                ))}
              </div>
            )}
          </a>
        </article>
      ))}
    </div>
  </div>
</BaseLayout>

<style>
  .category-page {
    max-width: 1000px;
    margin: 0 auto;
  }

  .category-header {
    text-align: center;
    margin-bottom: 3rem;
    padding-bottom: 2rem;
    border-bottom: 2px solid #333;
  }

  .category-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .category-title {
    font-size: 2.5rem;
    font-weight: 900;
    color: #fff;
    margin-bottom: 0.5rem;
  }

  .category-count {
    font-size: 1.125rem;
    color: #9ca3af;
  }

  .posts-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .posts-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .posts-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .post-card {
    background: #1a1a1a;
    border: 1px solid #333;
    border-radius: 0.5rem;
    padding: 1.5rem;
    transition: all 0.2s;
    height: 100%;
  }

  .post-card:hover {
    border-color: #60a5fa;
    box-shadow: 0 4px 12px rgba(96, 165, 250, 0.1);
    transform: translateY(-2px);
  }

  .post-card a {
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .post-card-header {
    margin-bottom: 1rem;
  }

  .post-card-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: #fff;
    margin-bottom: 0.5rem;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .post-card-date {
    font-size: 0.875rem;
    color: #6b7280;
  }

  .post-card-excerpt {
    flex: 1;
    color: #9ca3af;
    font-size: 0.9375rem;
    line-height: 1.6;
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .post-card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: auto;
  }

  .tag {
    padding: 0.125rem 0.5rem;
    background: #374151;
    color: #9ca3af;
    border-radius: 0.25rem;
    font-size: 0.75rem;
  }
</style>
